This repo contains Matlab code for tracking organoids. The organoids are assumed to not visually change over time (ie. the original image of the organoid can be used as a template for all time frames). The code tracks the position and rotation of the organoids over time.
The tracking is done by optimizing the cosine similarity between the current image frame and the organoid template (selected by the user from the first frame).

Repo Structure:
-OrganoidTracking.m: This is the main file, and runs the tracking program. You specify the video you wish to track, and then an interface appears for you to select the organoids. Once you have selected the organoids, the program tracks them, showing you the current tracked bounding box. Once the tracking is finished, the rotations are optimized using process_rot_data_speed.m. Finally, the tracked position, rotation, and cosine similarity data for the rotations (needed if you wish to redo the processing) are saved to a .json file, along with some metadata.
-BoudningBoxDrawer.m - Helper function for drawing the boudning boxes.
-gridSearchTracker.m: This defines the tracker class, which does the tracking of each organoid. During the initialization phase, the tracker creates a series of templates from the initially selected organoids by cropping the original image and making multiple rotated copies (one for each possible organoid orientation). The tracker works by iteratively searching an area around the current organoid for the "best" position and rotation, as defined by the cosine similarity of the templates with the section of the image centered on different locations within the search zone. The cosine similarity is calculated by computing the dot product (summed element-wise multiplication) of the template image, divided by the product of the L2 norms of the template of the image $\`frac{a*b}{(||a||*||b||)}\`$. 
-NNTemplateMatch.m: This does the dot product for the cosine similarity using a convolution neural network class. We use the CNN class to get built-in GPU acceleration.
-process_rot_data_speed.m: This function calculates the rotation of the organoid based on the cosine similarity of each possible rotation for each frame, adding constraints to the rotational speed of the organoid (deg/frame) and the rotational acceleration (deg/frame/frame). It calculates the series of rotations that minimizes $\`-\Sigma^{n_frames}_{t=1} similarity_{t, rot_t}, s.t. rot_{t+1} = rot_t + speed_t, speed_t - acc_{max} \le speed_{t+1} le speed_t + acc_{max}, speed_{min} \le speed_t \le speed_{max}. \`$
-optimize_rotations.m: This file re-runs process_rot_data_speed on a specified .json data file, and saves the updated tracker data to a new .json data file. This allows you to play with the rotation optimizer parameters without re-running the tracker.
-ExportJSONAsCSV.m - Reads a .json data file and exports the organoid positions and rotations to a .csv file, which can be easily imported to Excel.
-ReplayTrackingJSON.m - Visualizes the organoid tracking data stored in .json file. Replays the specified video, adding bounding boxes based on the data in the .json file. Useful for reviewing tracking data.
